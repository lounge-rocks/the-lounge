labels:
  backend: local

platform: "linux/arm64"

pipeline:
  - name: setup attic
    image: bash
    commands:
      - attic login lounge-rocks https://cache.lounge.rocks $ATTIC_KEY --set-default
    secrets: [attic_key]

  - name: build and push stuart
    image: bash
    commands:
      - nix build '.#nixosConfigurations.stuart.config.system.build.toplevel'
      - attic push nix-cache ./result

  - name: build and push woodpecker-agent-x86-1
    image: bash
    commands:
      - nix build '.#nixosConfigurations.woodpecker-agent-x86-1.config.system.build.toplevel'
      - attic push nix-cache ./result

  - name: build and push woodpecker-server
    image: bash
    commands:
      - nix build '.#nixosConfigurations.woodpecker-server.config.system.build.toplevel'
      - attic push nix-cache ./result
