---
kind: pipeline
type: exec
name: Build cache

platform:
  os: linux
  arch: arm64

steps:
  - name: Show flake info
    commands:
      - nix --experimental-features "nix-command flakes" flake show
      - nix --experimental-features "nix-command flakes" flake metadata

  - name: Run flake checks
    commands:
      - nix --experimental-features "nix-command flakes" flake check --show-trace

  - name: Build drone-runner
    commands:
      - nix build -v '.#nixosConfigurations.oracle-aarch64-runner-1.config.system.build.toplevel'

trigger:
  branch:
    - main
  event:
    - push
    - cron